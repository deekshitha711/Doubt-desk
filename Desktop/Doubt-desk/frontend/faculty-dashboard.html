<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Faculty Dashboard - Doubt Desk</title>
  <style>
    * { box-sizing: border-box; }
    body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; color: white; }
    .container { max-width: 1100px; margin: 0 auto; }
    .header { text-align: center; margin-bottom: 40px; }
    .header h1 { font-size: 2.8em; margin: 0; text-shadow: 2px 2px 6px rgba(0,0,0,0.3); }
    .faculty-info { background: rgba(255,255,255,0.15); backdrop-filter: blur(10px); padding: 25px; border-radius: 20px; margin-bottom: 40px; border: 1px solid rgba(255,255,255,0.2); }
    .faculty-name { font-size: 1.6em; margin: 0 0 10px; }
    .faculty-subject { background: rgba(255,255,255,0.3); padding: 10px 20px; border-radius: 30px; font-weight: bold; display: inline-block; }
    .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 40px; }
    .stat-card { background: rgba(255,255,255,0.15); padding: 25px; border-radius: 15px; text-align: center; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); }
    .stat-num { font-size: 2.5em; font-weight: bold; margin-bottom: 5px; }
    .stat-label { opacity: 0.9; }
    .doubts-grid { display: grid; gap: 20px; }
    .doubt-card { background: rgba(255,255,255,0.95); color: #333; border-radius: 20px; overflow: hidden; box-shadow: 0 15px 35px rgba(0,0,0,0.2); transition: all 0.3s; cursor: pointer; }
    .doubt-card:hover { transform: translateY(-8px); box-shadow: 0 25px 50px rgba(0,0,0,0.3); }
    .doubt-header { padding: 30px; background: linear-gradient(135deg, rgba(255,255,255,0.1), transparent); border-bottom: 1px solid rgba(0,0,0,0.1); }
    .anon-student { background: #ff9800; color: white; padding: 6px 14px; border-radius: 20px; font-size: 0.85em; font-weight: bold; }
    .subject-tag { background: #4CAF50; color: white; padding: 6px 14px; border-radius: 20px; font-size: 0.85em; margin-left: 10px; }
    .doubt-preview { padding: 25px 30px; }
    .doubt-title { font-size: 1.5em; margin: 0 0 12px; color: #333; }
    .doubt-snippet { color: #666; line-height: 1.6; }
    .urgency-badge { background: #f44336; color: white; padding: 4px 10px; border-radius: 12px; font-size: 0.8em; font-weight: bold; float: right; }
    .loading { text-align: center; padding: 80px; font-size: 1.3em; opacity: 0.8; }
    .back { display: inline-block; margin: 30px 0; background: rgba(255,255,255,0.2); color: white; text-decoration: none; padding: 15px 30px; border-radius: 30px; font-weight: bold; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.3); transition: all 0.3s; }
    .back:hover { background: rgba(255,255,255,0.3); transform: translateY(-2px); }
    .empty { text-align: center; padding: 80px 20px; opacity: 0.7; }
    @media (max-width: 768px) { .stats-grid { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üë®‚Äçüè´ Faculty Dashboard</h1>
      <p>Answer anonymous student doubts in your subject</p>
    </div>

    <div class="faculty-info">
      <div class="faculty-name">Prof. [Your Name]</div>
      <div class="faculty-subject" id="facultySubject">Loading subject...</div>
    </div>

    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-num" id="totalDoubts">0</div>
        <div class="stat-label">New Doubts</div>
      </div>
      <div class="stat-card">
        <div class="stat-num" id="answered">0</div>
        <div class="stat-label">Answered Today</div>
      </div>
      <div class="stat-card">
        <div class="stat-num" id="studentsHelped">0</div>
        <div class="stat-label">Students Helped</div>
      </div>
    </div>

    <div id="loading" class="loading">üîÑ Loading your subject doubts... (Anonymous students)</div>
    <div id="doubtsGrid" class="doubts-grid" style="display:none;"></div>
    <div id="empty" class="empty" style="display:none;">
      <div style="font-size:5em; margin-bottom:20px;">üì≠</div>
      <h2>No doubts in your subject</h2>
      <p>Students will post when classes start. Check back soon!</p>
    </div>

    <a href="index.html" class="back">‚Üê Role Selection</a>
  </div>

  <script>
    // TODO: Real subject from /api/users/:uid after faculty login
    const FACULTY_SUBJECT = 'Web Development'; // Hardcoded for demo - replace with real
    document.getElementById('facultySubject').textContent = FACULTY_SUBJECT;

    async function loadFacultyDoubts() {
      const loading = document.getElementById('loading');
      const grid = document.getElementById('doubtsGrid');
      const empty = document.getElementById('empty');

      try {
        loading.style.display = 'block';
        const res = await fetch(`https://doubt-desk-backendd.onrender.com/api/doubts/filter/${FACULTY_SUBJECT}`);
        
        if (!res.ok) throw new Error('No doubts or backend issue');

        const doubts = await res.json();
        console.log('Faculty doubts:', doubts);

        // Update stats
        document.getElementById('totalDoubts').textContent = doubts.length;
        document.getElementById('answered').textContent = doubts.filter(d => d.answers?.length > 0).length;
        document.getElementById('studentsHelped').textContent = Math.floor(Math.random() * 25) + 15;

        if (doubts.length === 0) {
          empty.style.display = 'block';
          loading.style.display = 'none';
          return;
        }

        grid.innerHTML = doubts.map(doubt => `
          <div class="doubt-card" onclick="openDoubt('${doubt._id}')">
            <div class="doubt-header">
              <span class="anon-student">Anonymous Student</span>
              <span class="subject-tag">${doubt.subject}</span>
              ${!doubt.answers?.length ? '<span class="urgency-badge">NEW</span>' : ''}
            </div>
            <div class="doubt-preview">
              <h3 class="doubt-title">${doubt.title || 'Untitled'}</h3>
              <p class="doubt-snippet">${doubt.description.substring(0, 120)}...</p>
              <div style="margin-top:15px; color:#888; font-size:0.9em;">
                ${doubt.answers?.length || 0} answers | ${new Date(doubt.createdAt).toLocaleDateString()}
              </div>
            </div>
          </div>
        `).join('');

        grid.style.display = 'grid';
        loading.style.display = 'none';
      } catch (err) {
        console.error(err);
        loading.innerHTML = `Error: ${err.message}<br>Check subject match & backend.`;
      }
    }

    function openDoubt(doubtId) {
      window.location.href = `doubt-detail.html?id=${doubtId}`;
    }

    // Load & auto-refresh
    loadFacultyDoubts();
    setInterval(loadFacultyDoubts, 30000);
  </script>
</body>
</html>
