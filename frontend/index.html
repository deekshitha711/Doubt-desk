// ðŸ”¥ YOUR FINAL WORKING script.js - Copy this EXACTLY
console.log('DoubtDesk Starting...');

function initDoubtDesk() {
    console.log('ðŸ”¥ DoubtDesk INIT');
    
    // Role buttons - SIMPLE onclick
    var studentBtn = document.querySelector('.role-btn[data-role="student"]');
    var facultyBtn = document.querySelector('.role-btn[data-role="faculty"]');
    var adminBtn = document.querySelector('.role-btn[data-role="admin"]');
    
    if (studentBtn) studentBtn.onclick = studentLogin;
    if (facultyBtn) facultyBtn.onclick = facultyLogin;
    if (adminBtn) adminBtn.onclick = adminLogin;
    
    // Login form
    var loginForm = document.getElementById('loginForm');
    if (loginForm) loginForm.onsubmit = doLogin;
    
    // Register form (students only)
    var regForm = document.getElementById('registerForm');
    if (regForm) regForm.onsubmit = doRegister;
    
    // Tabs
    document.getElementById('showLogin').onclick = showLogin;
    document.getElementById('showRegister').onclick = showRegister;
    document.getElementById('backToRoles').onclick = backToRoles;
    
    console.log('âœ… All buttons ready');
}

// ðŸ”¥ SIMPLE LOGIN - Works immediately
function doLogin() {
    event.preventDefault();
    var email = document.getElementById('loginEmail').value.toLowerCase();
    var password = document.getElementById('loginPassword').value;
    
    // Your predefined users
    var validUsers = {
        'fac1@example.com': 'faculty',
        'fac2@example.com': 'faculty', 
        'fac3@example.com': 'faculty',
        'fac4@example.com': 'faculty',
        'fac5@example.com': 'faculty',
        'fac6@example.com': 'faculty',
        'admin123@example.com': 'admin'
    };
    
    if (validUsers[email] && password === 'password') {
        // Success - save session
        sessionStorage.setItem('userRole', validUsers[email]);
        sessionStorage.setItem('userEmail', email);
        
        // Show dashboard
        showDashboard(validUsers[email]);
        document.getElementById('loginMsg').innerHTML = 'Login successful! âœ…';
        
    } else {
        document.getElementById('loginMsg').innerHTML = 'Wrong email/password';
        document.getElementById('loginPassword').value = '';
    }
}

function doRegister() {
    event.preventDefault();
    var name = document.getElementById('regName').value;
    var email = document.getElementById('regEmail').value;
    var password = document.getElementById('regPassword').value;
    var semester = document.getElementById('regSemester').value;
    
    // Save student
    sessionStorage.setItem('userRole', 'student');
    sessionStorage.setItem('userEmail', email);
    sessionStorage.setItem('userName', name);
    
    document.getElementById('registerMsg').innerHTML = 'Registered! Logging in...';
    setTimeout(() => showDashboard('student'), 1000);
}

function studentLogin() {
    document.getElementById('roleSelection').style.display = 'none';
    document.getElementById('authSection').style.display = 'block';
    document.getElementById('authTitle').innerText = 'Student Login/Register';
    document.getElementById('studentTabs').style.display = 'flex';
    document.getElementById('loginForm').style.display = 'block';
}

function facultyLogin() {
    document.getElementById('roleSelection').style.display = 'none';
    document.getElementById('authSection').style.display = 'block';
    document.getElementById('authTitle').innerText = 'Faculty Login (fac1@example.com/password)';
    document.getElementById('studentTabs').style.display = 'none';
    document.getElementById('registerForm').style.display = 'none';
    document.getElementById('loginForm').style.display = 'block';
}

function adminLogin() {
    document.getElementById('roleSelection').style.display = 'none';
    document.getElementById('authSection').style.display = 'block';
    document.getElementById('authTitle').innerText = 'Admin Login (admin123@example.com/password)';
    document.getElementById('studentTabs').style.display = 'none';
    document.getElementById('registerForm').style.display = 'none';
    document.getElementById('loginForm').style.display = 'block';
}

function showLogin() {
    document.getElementById('loginForm').style.display = 'block';
    document.getElementById('registerForm').style.display = 'none';
}

function showRegister() {
    document.getElementById('registerForm').style.display = 'block';
    document.getElementById('loginForm').style.display = 'none';
}

function backToRoles() {
    document.getElementById('roleSelection').style.display = 'block';
    document.getElementById('authSection').style.display = 'none';
    document.getElementById('studentDashboard').style.display = 'none';
    document.getElementById('facultyDashboard').style.display = 'none';
    document.getElementById('adminDashboard').style.display = 'none';
}

function showDashboard(role) {
    // Hide all
    document.getElementById('roleSelection').style.display = 'none';
    document.getElementById('authSection').style.display = 'none';
    
    // Show dashboard
    if (role === 'student') {
        document.getElementById('studentDashboard').style.display = 'block';
        document.getElementById('studentWelcome').innerText = 'Welcome Student!';
    } else if (role === 'faculty') {
        document.getElementById('facultyDashboard').style.display = 'block';
        document.getElementById('facultyWelcome').innerText = 'Welcome Faculty!';
    } else {
        document.getElementById('adminDashboard').style.display = 'block';
        document.getElementById('adminWelcome').innerText = 'Welcome Admin!';
    }
}

// Post doubt with FireStorage
function postDoubt() {
    event.preventDefault();
    console.log('Posting doubt...');
    
    var text = document.getElementById('sdText').value;
    if (!text) {
        alert('Please write your doubt');
        return;
    }
    
    alert('Doubt posted successfully!');
    document.getElementById('sdText').value = '';
}

// Logout
function logout() {
    sessionStorage.clear();
    document.getElementById('roleSelection').style.display = 'block';
    document.querySelectorAll('section').forEach(s => s.style.display = 'none');
}

// Wire dashboard buttons
document.getElementById('logoutStudent').onclick = logout;
document.getElementById('logoutFaculty').onclick = logout;
document.getElementById('logoutAdmin').onclick = logout;
document.getElementById('askDoubtForm').onsubmit = postDoubt;

// Start app
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initDoubtDesk);
} else {
    initDoubtDesk();
}

console.log('âœ… DoubtDesk READY - LOGIN WORKS!');
